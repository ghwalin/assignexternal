{"version":3,"file":"grader_navigation.min.js","sources":["../src/grader_navigation.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Javascript to handle changing users via the user selector in the header.\n *\n * @module     mod_assignexternal/grading_navigation\n * @copyright  2024 Marcel Suter <marcel@ghwalin.ch>\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n * @since      4.1\n */\nimport {fetchAllStudents} from './repository';\nexport const init = () => {\n    loadAllStudents().then(() => {\n        document.getElementById('user_autocomplete_downarrow').addEventListener('click', toggleUserlist);\n        document.getElementById('user_autocomplete_input').addEventListener('input', filterUserlist);\n        document.getElementById('user_autocomplete_suggestions').addEventListener('click', selectUser);\n        document.getElementById('previous-user').addEventListener('click', navigateUser);\n        document.getElementById('next-user').addEventListener('click', navigateUser);\n        return true;\n    })\n        .catch((error) => {\n            window.alert('Oops!' + error);\n        });\n};\n\n/**\n * loads all students for the current course\n * @returns {Promise<void>}\n */\nconst loadAllStudents = async() => {\n    const courseid = document.getElementsByName('courseid')[0].value;\n    const response = await fetchAllStudents(courseid);\n    let dropdown = document.getElementById('change-user-select');\n    let datalist = document.getElementById('user_autocomplete_suggestions');\n    const queryString = window.location.search;\n    const urlParams = new URLSearchParams(queryString);\n    const currentId = urlParams.get('userid');\n    for (let i= 0; i < response.length; i++) {\n        addStudents(response[i], dropdown, datalist, currentId);\n    }\n};\n\n/**\n * Adds a student to the dropdown and datalist\n * @param {object} student the student\n * @param {dom} dropdown\n * @param {dom} datalist\n * @param {int} currentStudentId\n */\nfunction addStudents(student, dropdown, datalist, currentStudentId) {\n    let option = document.createElement('option');\n    option.text = student.firstname + ' ' + student.lastname;\n    option.value = student.userid;\n    dropdown.add(option);\n\n    let item = document.createElement('li');\n    item.id = 'user_autocomplete_suggestion_' + student.userid;\n    item.innerHTML = student.firstname + ' ' + student.lastname + ' <small>' + student.email + '</small>';\n    item.setAttribute('data-value', student.userid);\n    if (student.userid == currentStudentId) {\n        item.setAttribute('aria-selected', 'true');\n        datalist.setAttribute('data-currentItem', datalist.childElementCount);\n    }\n    item.setAttribute('role', 'option');\n    datalist.appendChild(item);\n}\n\n/**\n * toggles show/noshow for the userlist\n */\nfunction toggleUserlist() {\n    let userlist = document.getElementById('user_autocomplete_suggestions');\n    if (userlist.style.display === 'none') {\n        userlist.style.display = 'inline';\n        document.getElementById('user_autocomplete_input').focus();\n    } else {\n        userlist.style.display = 'none';\n    }\n}\n\n/**\n * filter the userlist\n */\nfunction filterUserlist() {\n    const filter = document.getElementById('user_autocomplete_input').value.toUpperCase();\n    const userlist = document.getElementById('user_autocomplete_suggestions');\n    const users = userlist.getElementsByTagName('li');\n    userlist.style.display = 'inline';\n    for (const user of users) {\n        const value = user.innerText.toUpperCase();\n        if (filter === '' || value.includes(filter)) {\n            user.style.display = 'block';\n        } else {\n            user.style.display = 'none';\n        }\n    }\n}\n\n/**\n * gets the list item that was clicked\n * @param {Object} event  the event\n */\nfunction selectUser(event) {\n    let element = event.target;\n    if (event.target) {\n        if (event.target.nodeName === 'SMALL') {\n            element = event.target.parentNode;\n        }\n        const queryString = window.location.search;\n        const urlParams = new URLSearchParams(queryString);\n        urlParams.set('userid', element.getAttribute('data-value'));\n        window.location.href = '?' + urlParams.toString();\n    }\n\n}\n\n/**\n * navigates to the next or previous user\n * @param {Object} event\n */\nfunction navigateUser(event) {\n    const datalist = document.getElementById('user_autocomplete_suggestions');\n    const children = datalist.getElementsByTagName('LI');\n    let currentItem = datalist.getAttribute('data-currentitem');\n    if (event.target.id === 'previous-user') {\n        if (currentItem === '0') {\n            currentItem = children.length - 1;\n        } else {\n            currentItem--;\n        }\n    } else {\n        if (currentItem >= children.length - 1) {\n            currentItem = 0;\n        } else {\n            currentItem++;\n        }\n    }\n    const nextNode = children[currentItem];\n    const userid = nextNode.getAttribute('data-value');\n    const queryString = window.location.search;\n    const urlParams = new URLSearchParams(queryString);\n    urlParams.set('userid', userid);\n    window.location.href = '?' + urlParams.toString();\n}"],"names":["loadAllStudents","then","document","getElementById","addEventListener","toggleUserlist","filterUserlist","selectUser","navigateUser","catch","error","window","alert","async","courseid","getElementsByName","value","response","dropdown","datalist","queryString","location","search","currentId","URLSearchParams","get","i","length","addStudents","student","currentStudentId","option","createElement","text","firstname","lastname","userid","add","item","id","innerHTML","email","setAttribute","childElementCount","appendChild","userlist","style","display","focus","filter","toUpperCase","users","getElementsByTagName","user","innerText","includes","event","element","target","nodeName","parentNode","urlParams","set","getAttribute","href","toString","children","currentItem"],"mappings":"oMAwBoB,KAChBA,kBAAkBC,MAAK,KACnBC,SAASC,eAAe,+BAA+BC,iBAAiB,QAASC,gBACjFH,SAASC,eAAe,2BAA2BC,iBAAiB,QAASE,gBAC7EJ,SAASC,eAAe,iCAAiCC,iBAAiB,QAASG,YACnFL,SAASC,eAAe,iBAAiBC,iBAAiB,QAASI,cACnEN,SAASC,eAAe,aAAaC,iBAAiB,QAASI,eACxD,KAENC,OAAOC,QACJC,OAAOC,MAAM,QAAUF,iBAQ7BV,gBAAkBa,gBACdC,SAAWZ,SAASa,kBAAkB,YAAY,GAAGC,MACrDC,eAAiB,gCAAiBH,cACpCI,SAAWhB,SAASC,eAAe,sBACnCgB,SAAWjB,SAASC,eAAe,uCACjCiB,YAAcT,OAAOU,SAASC,OAE9BC,UADY,IAAIC,gBAAgBJ,aACVK,IAAI,cAC3B,IAAIC,EAAG,EAAGA,EAAIT,SAASU,OAAQD,IAChCE,YAAYX,SAASS,GAAIR,SAAUC,SAAUI,qBAW5CK,YAAYC,QAASX,SAAUC,SAAUW,sBAC1CC,OAAS7B,SAAS8B,cAAc,UACpCD,OAAOE,KAAOJ,QAAQK,UAAY,IAAML,QAAQM,SAChDJ,OAAOf,MAAQa,QAAQO,OACvBlB,SAASmB,IAAIN,YAETO,KAAOpC,SAAS8B,cAAc,MAClCM,KAAKC,GAAK,gCAAkCV,QAAQO,OACpDE,KAAKE,UAAYX,QAAQK,UAAY,IAAML,QAAQM,SAAW,WAAaN,QAAQY,MAAQ,WAC3FH,KAAKI,aAAa,aAAcb,QAAQO,QACpCP,QAAQO,QAAUN,mBAClBQ,KAAKI,aAAa,gBAAiB,QACnCvB,SAASuB,aAAa,mBAAoBvB,SAASwB,oBAEvDL,KAAKI,aAAa,OAAQ,UAC1BvB,SAASyB,YAAYN,eAMhBjC,qBACDwC,SAAW3C,SAASC,eAAe,iCACR,SAA3B0C,SAASC,MAAMC,SACfF,SAASC,MAAMC,QAAU,SACzB7C,SAASC,eAAe,2BAA2B6C,SAEnDH,SAASC,MAAMC,QAAU,gBAOxBzC,uBACC2C,OAAS/C,SAASC,eAAe,2BAA2Ba,MAAMkC,cAClEL,SAAW3C,SAASC,eAAe,iCACnCgD,MAAQN,SAASO,qBAAqB,MAC5CP,SAASC,MAAMC,QAAU,aACpB,MAAMM,QAAQF,MAAO,OAChBnC,MAAQqC,KAAKC,UAAUJ,cACd,KAAXD,QAAiBjC,MAAMuC,SAASN,QAChCI,KAAKP,MAAMC,QAAU,QAErBM,KAAKP,MAAMC,QAAU,iBASxBxC,WAAWiD,WACZC,QAAUD,MAAME,UAChBF,MAAME,OAAQ,CACgB,UAA1BF,MAAME,OAAOC,WACbF,QAAUD,MAAME,OAAOE,kBAErBxC,YAAcT,OAAOU,SAASC,OAC9BuC,UAAY,IAAIrC,gBAAgBJ,aACtCyC,UAAUC,IAAI,SAAUL,QAAQM,aAAa,eAC7CpD,OAAOU,SAAS2C,KAAO,IAAMH,UAAUI,qBAStCzD,aAAagD,aACZrC,SAAWjB,SAASC,eAAe,iCACnC+D,SAAW/C,SAASiC,qBAAqB,UAC3Ce,YAAchD,SAAS4C,aAAa,oBAChB,kBAApBP,MAAME,OAAOnB,GACO,MAAhB4B,YACAA,YAAcD,SAASvC,OAAS,EAEhCwC,cAGAA,aAAeD,SAASvC,OAAS,EACjCwC,YAAc,EAEdA,oBAIF/B,OADW8B,SAASC,aACFJ,aAAa,cAC/B3C,YAAcT,OAAOU,SAASC,OAC9BuC,UAAY,IAAIrC,gBAAgBJ,aACtCyC,UAAUC,IAAI,SAAU1B,QACxBzB,OAAOU,SAAS2C,KAAO,IAAMH,UAAUI"}